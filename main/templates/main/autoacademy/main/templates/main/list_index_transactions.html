
{% load static %}
{% load humanize %}

<!--Anything under block content will be displayed  -->
{% block content %}


{% if user.is_authenticated %}

<div class="row">

  {% if messages %}
  <div class="col-12">  
   {% for message in messages %}
   <p class="bg-success text-white" style="width:100% !important; text-align: center;">{{message}}</p>
   {% endfor %}
  </div>
  {% endif %}
<div class="col-12 col-md-2"></div>
  
<div class="col-12 col-md-8">
  <div class="row">
  <h1 class="bg-info text-white col-12"style="font-size: 15px !important; line-height:35px; text-align: center;">
    MAKE INVOICE / RECEIPT</h1>
  </div>
  <nav>
    <div class="nav nav-tabs cashier-nav" id="nav-tab" role="tablist">


      <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">
        <img src="{% get_media_prefix %}{{request.session.saloon_car}}" alt="saloon car"> 
      </button>

      <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">
        <img src="{% get_media_prefix %}{{request.session.pickup_car}}" alt="pickup car">
      </button>

      <button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false">
        <img src="{% get_media_prefix %}{{request.session.truck_car}}" alt="truck car">
      </button>


    </div>
  </nav>
  <div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">

      <form method="POST" action="{% url 'make-car-transaction' %}"> 
        {% csrf_token %}
        <div class = "row">
          <p class="bg-danger text-white" style="width:100%; margin-bottom: -2px;
           line-height:30px !important; border-top-left-radius: 5px; border-top-right-radius: 5px; ">
           SALOON CAR</p>

           <table style="margin-bottom: 8px; margin-top: 8px;" class="col-8 col-md-4">
            <tr>
                <td colspan="2">Number plate type</td>
            </tr>
        <tr><td>
           <input type="radio" value="Normal" name="plate-type" checked>
           <span style="font-size: 11px;">Normal</span> &nbsp;
        </td><td>
           <input type="radio" value="Private" name="plate-type" >
           <span style="font-size: 11px;">Private</span>
        </td></tr>
        </table>
          
          <input type="hidden" name="item-name" value="{{saloon_car_name}}">
          <input class="col-12" type="hidden" name="make-car-invoice" value="make-car-invoice">
          <input class="col-12" type="text" name="plate-number" placeholder="Plate Number" required>

          <div class="col-12">
            <div class="row">
          <table class="col-12">
            <tr>
              <td style="width:30%;">
                <input  type="number" name="quantity" value="1" required style="width:100%;">
              </td>
              <td style="width:70%;">
                <input  type="text" name="amount" value="{{saloon_car_price}}" disabled style="width:100%;">
              </td>
            </tr>
          </table> 
        </div>
        </div>
        
          <button style="margin-top: 5px; width:60px; width:60px;" 
           class="btn btn-sm btn-danger text-white"
           onclick="this.disabled=true,this.form.submit();">Submit</button> 
        </div>
      </form>
    </div>

    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">


        <form  method="POST" action="{% url 'make-car-transaction' %}"> 
          {% csrf_token %}
          <div class = "row">
        <p class="bg-primary text-white" style="width:100%; margin-bottom: -2px;
         line-height:30px !important; border-top-left-radius: 5px; border-top-right-radius: 5px; ">
         PICKUP CAR</p>

        <table style="margin-bottom: 8px; margin-top: 8px;" class="col-8 col-md-4">
          <tr>
              <td colspan="2">Number plate type</td>
          </tr>
      <tr><td>
         <input type="radio" value="Normal" name="plate-type" checked>
         <span style="font-size: 11px;">Normal</span> &nbsp;
      </td><td>
         <input type="radio" value="Private" name="plate-type" >
         <span style="font-size: 11px;">Private</span>
      </td></tr>
      </table>
        
        <input type="hidden" name="item-name" value="{{pickup_car_name}}">
        <input class="col-12" type="hidden" name="make-car-invoice" value="make-car-invoice"> 
        <input class="col-12" type="text" name="plate-number" placeholder="Plate Number" required>

        <div class="col-12">
          <div class="row">
        <table class="col-12">
          <tr>
            <td style="width:30%;">
              <input  type="number" name="quantity" value="1" required style="width:100%;">
            </td>
            <td style="width:70%;">
              <input  type="text" name="amount" value="{{pickup_car_price}}" disabled style="width:100%;">
            </td>
          </tr>
        </table> 
      </div>
      </div>
        <button style="margin-top: 5px; width:60px;" 
         class="btn btn-sm btn-primary text-white"
         onclick="this.disabled=true,this.form.submit();">Submit</button> 
      </div>
    </form>
    </div>

    <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
      <form  method="POST" action="{% url 'make-car-transaction' %}"> 
        {% csrf_token %}
        <div class = "row">
      <p class="bg-dark text-white" style="width:100%; margin-bottom: -2px;
       line-height:30px !important; border-top-left-radius: 5px; border-top-right-radius: 5px; ">
       TRUCK CAR</p>

       <table style="margin-bottom: 8px; margin-top: 8px;" class="col-8 col-md-4">
        <tr>
            <td colspan="2">Number plate type</td>
        </tr>
    <tr><td>
       <input type="radio" value="Normal" name="plate-type" checked>
       <span style="font-size: 11px;">Normal</span> &nbsp;
    </td><td>
       <input type="radio" value="Private" name="plate-type" >
       <span style="font-size: 11px;">Private</span>
    </td></tr>
    </table>

      <input type="hidden" name="item-name" value="{{truck_car_name}}">
      <input class="col-12" type="hidden" name="make-car-invoice" value="make-car-invoice"> 
      <input class="col-12" type="text" name="plate-number" placeholder="Plate Number" required>

      <div class="col-12">
        <div class="row">
      <table class="col-12">
        <tr>
          <td style="width:30%;">
            <input  type="number" name="quantity" value="1" required style="width:100%;">
          </td>
          <td style="width:70%;">
            <input  type="text" name="amount" value="{{truck_car_price}}" disabled style="width:100%;">
          </td>
        </tr>
      </table> 
    </div>
    </div>
    
      <button style="margin-top: 5px; width:60px;" 
       class="btn btn-sm btn-dark text-white"
       onclick="this.disabled=true,this.form.submit();">Submit</button> 
    </div>
  </form>
       
    </div>
  </div>

</div>

</div>
  

<div class="row">

  {% if current_car %}

  <p></p>

  <p style="">Plate No: <b><i>{{current_car.particulars}}</i></b> Total Balance: <b><i> 
    {{request.session.current_car_balance | floatformat:0 | intcomma }}</i></b>
  </p>

  {% if current_car.paid %}

  <div  class="col-12 col-md-4"  id="print-receipt"
  style="background: rgb(232, 232, 248); margin-bottom: 20px;">
    <div class="row">
      <div  class="col-12"> 
    <h2 style="font-weight: bold; text-align: center; line-height: 35px;" class="bg-dark text-white"
    ><i>RECEIPT</i></h2>

    <p style="text-align: left; margin: 0px; text-transform: uppercase;">
      <b>{{paid_car.governing_bodyID}}</b><br/>
              <i><b>{{paid_car.RegionID}}</b></i>, <b>{{paid_car.streetID}}</b></p>

    <p >
      ============================<br/>
      <span>Receipt No: <b>{{current_car.id}}-{{paid_car.id}}</b></span><br/>
      For Plate No: <b><i>{{current_car.particulars}}</i></b><br/> 
      {% if current_car.request_refund %}Refund Request: <span 
      style="color:red;"><b><i>Sent</i></b></span><br/>{% endif %}
      {% if current_car.refunded %}<span></span> Refund Status: <span style="color:red;"><b><i>{{refund_status}}</i></b></span></span><br/>{% endif %}
     
      <span>Valid On: <b>{{current_car.date_of_validity | date:"M d, Y"}}</b></span><br/>
      Amount: <span class="text-danger"><i><b>{{paid_car.amount | intcomma }}</b></i></span><br/>
      <span>-----------------</span><br/>
      Record Date: <i>{{paid_car.record_date}}</i><br/>
    </p>
    <p>
      Printed by: <b>{{request.user}}</b><br/>
      Printed: <b>{% now "jS F Y H:i" %}</b></p>
    <p>
      <p>
        Copyright  © {% now 'Y' %},<br/> <b>{{dtl_info.dtl_full_name}}</b>, 
        <span style="font-size:13px;">{{dtl_info.phone_number}},
        {{dtl_info.email}}, {{dtl_info.address}}, <i>{{dtl_info.other_details}}</i></span>
        </p>    
      <table>
        <tr>
          <td>

      <button onclick="printDiv()" class="print-button btn btn-success btn-sm"
      class="btn btn-sm btn-success" style="margin-top:-17px;">Print</button>

      



      </td>
      <td>
       <!--Hide refund request form if request has been sent -->
       {% if current_car.request_refund %} {% else %}
        <form method="POST" action="{% url 'make-car-transaction' %}" style="padding: 0px !important;">
          {% csrf_token %}
        <input type="hidden" name="car-request-refund-id" value="{{current_car.id}}">
          <button class="btn btn-sm btn-danger">Request Refund</button>
        </form>
      {% endif %}
      </td>
    </tr>
    </table>


</div>
</div>
</div>

  {% endif %}

    <!---- Below is a list os of this user today transactions in descening order-->
    <div  class="col-12 col-md-4" style="background: rgb(232, 232, 248); margin-bottom: 20px;">
     
      <h2 style="font-weight: bold; text-align: center; line-height: 35px;" 
      class="bg-dark text-white"><i>IVOICE</i></h2>
      <p style="text-align: left; margin: 0px; text-transform: uppercase;">
        <b>{{current_car.governing_bodyID}}</b><br/>
                <i><b>{{current_car.RegionID}}</b></i>, <b>{{current_car.streetID}}</b>
      </p>
      ============================
      <p>
        <span>Invoice No: <b>{{current_car.id}}</b></span><br/>
        On: <b>{{current_car.record_date}}</b><br/>
        <span>Pay Status: <b>{{pay_status}}</b></span><br/>
        Plate No: <b><i>{{current_car.particulars}}</i></b><br/> 
        Amount: <span class="text-danger"><i><b>{{current_car.inc_amount | intcomma  }}</b></i></span><br/>
        <span>-----------------</span><br/>
        <p>
          Printed by: <b>{{request.user}}</b><br/>
          Printed: <b>{% now "jS F Y H:i" %}</b></p>
        <p>
          Copyright  © {% now 'Y' %}, <b>{{dtl_info.dtl_full_name}}</b>, 
          <span style="font-size:13px;">{{dtl_info.phone_number}},
          {{dtl_info.email}}, {{dtl_info.address}}, <i>{{dtl_info.other_details}}</i></span>
          </p>
         
        <table>
          <tr>
            <td>

        <button class="btn btn-sm btn-success" style="margin-top:-17px;">Print</button>

        </td>
        <td>
          {% if current_car.paid %}{% else %}
        <form method="POST" action="{% url 'make-car-transaction' %}" style="padding: 0px !important;">
          {% csrf_token %}
        <input type="hidden" name="car-pay-id" value="{{current_car.id}}">
          <button class="btn btn-sm btn-primary">Pay Now</button>
        </form>
        {% endif %}
        </td>
      </tr>
      </table>

  </table>

  </div>

  

  {% endif %}
</div>


<div class="col-12">
  <div class="row">
  <h1 class="col-12">
    Today's Payments
  </h1>
  <table class="table table-striped table-bordered col-12">
    <thead class="bg-dark text-white">
      <td>No#</td>
      <td>Record Date</td>
      <td>Date Of Validity</td>
      <td>Invoice Type</td>
      <td>Particulars</td>
      <td>Amount</td>
      <td>Recoding User</td>
      <td>Street</td>
    </thead>
    <tbody>
      
      {% for car in current_car_paid %}
      <tr >
        <td><a href="{% url 'set-current-car-by-click' car.id %}">{{ car.id }}</a></td>
          <td>   

            <a href="{% url 'set-current-car-by-click' car.id %}">{{ car.record_date }}</a>
      </td>
      <td> <a href="{% url 'set-current-car-by-click' car.id %}">{{ car.date_of_validity  | date:"M d, Y" }}</a></td>
      <td> <a href="{% url 'set-current-car-by-click' car.id %}">{{ car.invoice_typeID }}</a></td>
          <td><a href="{% url 'set-current-car-by-click' car.id %}">{{ car.particulars }}</a></td>
          <td><a href="{% url 'set-current-car-by-click' car.id %}">{{ car.inc_amount | intcomma }}</a></td>
          <td><a href="{% url 'set-current-car-by-click' car.id %}">{{ car.user_full_name }}</a></td>
          <td><a href="{% url 'set-current-car-by-click' car.id %}">{{ car.streetID }}</a></td>
      </tr>

      {% endfor %}
  </tbody>

    </tbody>
    <tfoot class="bg-dark text-white">
      <td></td>
      <td></td>
      <td><b></i></b> <b><i></i></b></td>
      <td> </td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tfoot>
  </table>
</div>
</div>


<div class="col-12">
  <div class="row">

<h1 class="col-12">
  UnPaid Invoices
</h1>

  <table class="table table-striped table-bordered col-12">
    <thead class="bg-dark text-white">
      <td>No#</td>
      <td>Record Date</td>
      <td>Invoice Type</td>
      <td>Particulars</td>
      <td>Amount</td>
      <td>Recoding User</td>
      <td>Street</td>
    </thead>
    <tbody style="background: rgb(250,190,190);">
      
      {% for car in current_car_unpaid %}
      <tr >
        <td><a href="{% url 'set-current-car-by-click' car.id %}">{{ car.id }}</a></td>
          <td>   
            <button class="btn btn-primary text-white"
            data-bs-target="#pay-this-invoice-{{car.id}}" data-bs-toggle="collapse">
            <i class="fa fa-arrow-down"></i>
            </button>
           <div id="pay-this-invoice-{{car.id}}" class="collapse">
            <table><tr><td>
            <form  method="POST" action = "" >
              {% csrf_token %}
              <input type="hidden" name="car-pay-id" value="{{car.id}}">
              <input type="number" name="amountx" value="{{car.inc_amount}}" disabled><br>
              <button style="margin-top: 4px;;" class="btn btn-sm btn-primary text-white"
              onclick="this.disabled=true,this.form.submit();">Pay Now</button>
            </form>
          </td></tr>
          <tr>
          <td>
            <form method="POST" action="" style="margin-top: -30px;">
              {% csrf_token %}
              <input type="hidden" name="del-car-id" value="{{car.id}}">
              <p></p>
              <button type="submit" class="btn btn-danger text-white btn-sm"
              onclick="this.disabled=true,this.form.submit();" >X Delete</button>
            </form>
          </td></tr>
          </table>
          </div>

            <a href="{% url 'set-current-car-by-click' car.id %}">{{ car.record_date }}</a>
      </td>
      <td> <a href="{% url 'set-current-car-by-click' car.id %}">{{ car.invoice_typeID }}</a></td>
          <td><a href="{% url 'set-current-car-by-click' car.id %}">{{ car.particulars }}</a></td>
          <td><a href="{% url 'set-current-car-by-click' car.id %}">{{ car.inc_amount | intcomma }}</a></td>
          <td><a href="{% url 'set-current-car-by-click' car.id %}">{{ car.user_full_name }}</a></td>
          <td><a href="{% url 'set-current-car-by-click' car.id %}">{{ car.streetID }}</a></td>
      </tr>

      {% endfor %}
  </tbody>

    </tbody>
    <tfoot class="bg-dark text-white">
      <td></td>
      <td></td>
      <td><b>Total: <i>{{ total_unpaid | floatformat:0 | intcomma }}</i></b> <b><i></i></b></td>
      <td> </td>
      <td></td>
      <td></td>
      <td></td>
    </tfoot>
  </table>
</div>
</div>



  <div class="row">
  <h1 class="col-12">
<h1>Payment History</h1>

{% if current_car_paid_history %}


<table class="table table-striped table-bordered col-12">
  <thead class="bg-dark text-white">
    <td>No#</td>
    <td>Record Date</td>
    <td>Date Of Validity</td>
    <td>Invoice Type</td>
    <td>Particulars</td>
    <td>Amount</td>
    <td>Recoding User</td>
    <td>Street</td>
  </thead>
  <tbody style="background: rgb(159, 241, 177);">
    
    {% for paid_car in current_car_paid_history  %}
    <tr >
        <td><a href="{% url 'set-current-car-by-click' paid_car.id %}">{{ paid_car.id }}</a></td>
        <td> <a href="{% url 'set-current-car-by-click' paid_car.id %}">{{ paid_car.record_date }}</a></td>
        <td> <a href="{% url 'set-current-car-by-click' paid_car.id %}">{{ paid_car.date_of_validity  | date:"M d, Y" }}</a></td>
        <td> <a href="{% url 'set-current-car-by-click' paid_car.id %}">{{ paid_car.invoice_typeID }}</a></td>
        <td><a href="{% url 'set-current-car-by-click' paid_car.id %}">{{ paid_car.particulars }}</a></td>
        <td><a href="{% url 'set-current-car-by-click' paid_car.id %}">{{ paid_car.inc_amount | intcomma }}</a></td>
        <td><a href="{% url 'set-current-car-by-click' paid_car.id %}">{{ paid_car.user_full_name }}</a></td>
        <td><a href="{% url 'set-current-car-by-click' paid_car.id %}">{{ paid_car.streetID }}</a></td>
    </tr>

    {% endfor %}
</tbody>

  </tbody>
  <tfoot class="bg-dark text-white">
    <td></td>
    <td></td>
    <td></td>
    <td> </td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tfoot>
</table>



{% endif %}

</div>
</div>

{% endif %}

<!--Ends block content-->
{% endblock %}




